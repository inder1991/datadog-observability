{{- if .Values.dashboards.rumBusiness.enabled }}
apiVersion: datadoghq.com/v1alpha1
kind: DatadogDashboard
metadata:
  name: {{ include "dashboards.serviceName" . }}-rum-business
  labels:
    service: {{ include "dashboards.serviceName" . }}
    dashboard-type: rum-business
spec:
  title: "RUM Business: {{ include "dashboards.serviceName" . }}"
  description: "Business and performance metrics for {{ include "dashboards.serviceName" . }}"
  experienceType: default
  widgets: '[{"id":5187685323645027,"definition":{"type":"note","content":"# Business & Performance Metrics\nReal-time monitoring of {{ include "dashboards.serviceName" . }} in {{ .Values.environment }}","background_color":"blue","font_size":"14","text_align":"center","show_tick":false}},{"id":8637167898987795,"definition":{"title":"Total Page Views (24h)","type":"query_value","requests":[{"response_format":"scalar","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:view service:{{ include "dashboards.serviceName" . }} env:{{ .Values.environment }}"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"formula":"query1"}]}],"autoscale":true,"precision":0}},{"id":5233095573846727,"definition":{"title":"Total Errors (24h)","type":"query_value","requests":[{"response_format":"scalar","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:error service:{{ include "dashboards.serviceName" . }} env:{{ .Values.environment }}"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"formula":"query1"}]}],"autoscale":true,"precision":0}},{"id":5843829718379654,"definition":{"title":"Avg LCP (seconds)","type":"query_value","requests":[{"response_format":"scalar","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:view service:{{ include "dashboards.serviceName" . }} env:{{ .Values.environment }}"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"avg","metric":"@view.largest_contentful_paint"},"storage":"hot"}],"formulas":[{"formula":"query1 / 1000000000"}]}],"autoscale":false,"precision":2}},{"id":6513096168018942,"definition":{"title":"Avg FID (ms)","type":"query_value","requests":[{"response_format":"scalar","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:view service:{{ include "dashboards.serviceName" . }} env:{{ .Values.environment }}"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"avg","metric":"@view.first_input_delay"},"storage":"hot"}],"formulas":[{"formula":"query1 / 1000000","number_format":{"unit":{"type":"canonical_unit","unit_name":"millisecond"}}}]}],"autoscale":false,"precision":0}},{"id":4041679986859830,"definition":{"title":"Page Views Over Time","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:view service:{{ include "dashboards.serviceName" . }} env:{{ .Values.environment }}"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"formula":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]}},{"id":5820410479377337,"definition":{"title":"Errors Over Time","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:error service:{{ include "dashboards.serviceName" . }} env:{{ .Values.environment }}"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"formula":"query1"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}]}},{"id":1402097911415485,"definition":{"title":"LCP Trend (seconds)","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:view service:{{ include "dashboards.serviceName" . }} env:{{ .Values.environment }}"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"avg","metric":"@view.largest_contentful_paint"},"storage":"hot"}],"formulas":[{"formula":"query1 / 1000"}],"style":{"palette":"cool"},"display_type":"line"}],"yaxis":{"min":"0"}}},{"id":7089911054978058,"definition":{"title":"FID Trend (milliseconds)","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:view service:{{ include "dashboards.serviceName" . }} env:{{ .Values.environment }}"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"avg","metric":"@view.first_input_delay"},"storage":"hot"}],"formulas":[{"formula":"query1"}],"style":{"palette":"purple"},"display_type":"line"}],"yaxis":{"min":"0"}}},{"id":8128179876818723,"definition":{"type":"note","content":"## Next Steps\n\n1. Add custom actions for conversion tracking\n2. Enable session replay\n3. Set up alerts\n\n**Quick Links:**\n- [RUM Explorer](https://app.datadoghq.com/rum/explorer)\n- [Session Replays](https://app.datadoghq.com/rum/sessions)","background_color":"gray","font_size":"14","text_align":"left","show_tick":false}}]'
  templateVariables: []
  layoutType: ordered
  notifyList: []
  pauseAutoRefresh: false
  reflowType: auto
{{- end }}
